I"Áu<blockquote>
  <p>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œç½‘ç»œä¼˜åŒ–æ˜¯ä¸€æ–¹é¢ï¼Œæ•°æ®é›†çš„ä¼˜åŒ–åˆæ˜¯å¦ä¸€æ–¹é¢ã€‚æ•°æ®é›†ä¼šå­˜åœ¨å„ç±»æ ·æœ¬ä¸å‡åŒ€çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯å„ç±»æ ·æœ¬çš„æ•°é‡ä¸ä¸€æ ·ï¼Œæœ‰çš„ç”šè‡³å·®åˆ«å¾ˆå¤§ã€‚ä¸ºäº†è®©æ¨¡å‹å…·æœ‰æ›´å¼ºçš„é²æ£’æ€§ï¼Œé‡‡ç”¨Data Augmentationæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p>
</blockquote>

<h1 id="å¸¸ç”¨çš„æ–¹æ³•">å¸¸ç”¨çš„æ–¹æ³•</h1>

<ul>
  <li>Color Jitteringï¼šå¯¹é¢œè‰²çš„æ•°æ®å¢å¼ºï¼šå›¾åƒäº®åº¦ã€é¥±å’Œåº¦ã€å¯¹æ¯”åº¦å˜åŒ–ï¼ˆæ­¤å¤„å¯¹è‰²å½©æŠ–åŠ¨çš„ç†è§£ä¸çŸ¥æ˜¯å¦å¾—å½“ï¼‰</li>
  <li>PCA Jitteringï¼šé¦–å…ˆæŒ‰ç…§RGBä¸‰ä¸ªé¢œè‰²é€šé“è®¡ç®—å‡å€¼å’Œæ ‡å‡†å·®ï¼Œå†åœ¨æ•´ä¸ªè®­ç»ƒé›†ä¸Šè®¡ç®—åæ–¹å·®çŸ©é˜µï¼Œè¿›è¡Œç‰¹å¾åˆ†è§£ï¼Œå¾—åˆ°ç‰¹å¾å‘é‡å’Œç‰¹å¾å€¼ã€‚å‚è§<a href="https://papers.nips.cc/paper/4824-imagenet-classification-with-deep-convolutional-neural-networks.pdf">è®ºæ–‡</a></li>
  <li>Random Scaleï¼šå°ºåº¦å˜æ¢</li>
  <li>Random Cropï¼šé‡‡ç”¨éšæœºå›¾åƒå·®å€¼æ–¹å¼ï¼Œå¯¹å›¾åƒè¿›è¡Œè£å‰ªã€ç¼©æ”¾ï¼›åŒ…æ‹¬Scale Jitteringæ–¹æ³•ï¼ˆVGGåŠResNetæ¨¡å‹ä½¿ç”¨ï¼‰æˆ–è€…å°ºåº¦å’Œé•¿å®½æ¯”å¢å¼ºå˜æ¢</li>
  <li>Horizontal/Vertical Flipï¼šæ°´å¹³/å‚ç›´ç¿»è½¬</li>
  <li>Shiftï¼šå¹³ç§»å˜æ¢</li>
  <li>Rotation/Reflectionï¼šæ—‹è½¬/ä»¿å°„å˜æ¢</li>
  <li>Noiseï¼šé«˜æ–¯å™ªå£°ã€æ¨¡ç³Šå¤„ç†</li>
  <li>Label shuffleï¼šç±»åˆ«ä¸å¹³è¡¡æ•°æ®çš„å¢å¹¿ï¼Œå‚è§æµ·åº·å¨è§†ILSVRC2016çš„report</li>
</ul>

<hr />

<h1 id="imagedatageneratorå‡½æ•°">ImageDataGenerator()å‡½æ•°</h1>
<p>è¿™æ˜¯Kerasæä¾›çš„ä¸€ä¸ªè‡ªåŠ¨å¢å¼ºçš„å‡½æ•°</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ImageDataGenerator</span><span class="p">(</span>
	<span class="n">featurewise_center</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">samplewise_center</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">featurewise_std_normalization</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">samplewise_std_normalization</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">zca_whitening</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">rotation_range</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
    <span class="n">width_shift_range</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
    <span class="n">height_shift_range</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
    <span class="n">shear_range</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
    <span class="n">zoom_range</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
    <span class="n">channel_shift_range</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
    <span class="n">fill_mode</span><span class="o">=</span><span class="s">'nearest'</span><span class="p">,</span>
    <span class="n">cval</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
    <span class="n">horizontal_flip</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">vertical_flip</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">rescale</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">dim_ordering</span><span class="o">=</span><span class="n">K</span><span class="o">.</span><span class="n">image_dim_ordering</span><span class="p">())</span>
</code></pre></div></div>
<p>å‚æ•°è§£é‡Šï¼Œæ‰€æœ‰å‚æ•°ä¸ä¸€å®šéƒ½éœ€è¦åŒ…æ‹¬ï¼Œå¯ä»¥ä¸å†™ã€‚</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>featurewise_centerï¼šå¸ƒå°”å€¼ï¼Œä½¿è¾“å…¥æ•°æ®é›†å»ä¸­å¿ƒåŒ–ï¼ˆå‡å€¼ä¸º0ï¼‰
samplewise_centerï¼šå¸ƒå°”å€¼ï¼Œä½¿è¾“å…¥æ•°æ®çš„æ¯ä¸ªæ ·æœ¬å‡å€¼ä¸º0
featurewise_std_normalizationï¼šå¸ƒå°”å€¼ï¼Œå°†è¾“å…¥é™¤ä»¥æ•°æ®é›†çš„æ ‡å‡†å·®ä»¥å®Œæˆæ ‡å‡†åŒ–
samplewise_std_normalizationï¼šå¸ƒå°”å€¼ï¼Œå°†è¾“å…¥çš„æ¯ä¸ªæ ·æœ¬é™¤ä»¥å…¶è‡ªèº«çš„æ ‡å‡†å·®
zca_whiteningï¼šå¸ƒå°”å€¼ï¼Œå¯¹è¾“å…¥æ•°æ®æ–½åŠ ZCAç™½åŒ–
rotation_rangeï¼šæ•´æ•°ï¼Œæ•°æ®æå‡æ—¶å›¾ç‰‡éšæœºè½¬åŠ¨çš„è§’åº¦
width_shift_rangeï¼šæµ®ç‚¹æ•°ï¼Œå›¾ç‰‡å®½åº¦çš„æŸä¸ªæ¯”ä¾‹ï¼Œæ•°æ®æå‡æ—¶å›¾ç‰‡æ°´å¹³åç§»çš„å¹…åº¦
height_shift_rangeï¼šæµ®ç‚¹æ•°ï¼Œå›¾ç‰‡é«˜åº¦çš„æŸä¸ªæ¯”ä¾‹ï¼Œæ•°æ®æå‡æ—¶å›¾ç‰‡ç«–ç›´åç§»çš„å¹…åº¦
shear_rangeï¼šæµ®ç‚¹æ•°ï¼Œå‰ªåˆ‡å¼ºåº¦ï¼ˆé€†æ—¶é’ˆæ–¹å‘çš„å‰ªåˆ‡å˜æ¢è§’åº¦ï¼‰
zoom_rangeï¼šæµ®ç‚¹æ•°æˆ–å½¢å¦‚[lower,upper]çš„åˆ—è¡¨ï¼Œéšæœºç¼©æ”¾çš„å¹…åº¦ï¼Œè‹¥ä¸ºæµ®ç‚¹æ•°ï¼Œåˆ™ç›¸å½“äº[lower,upper] = [1 - zoom_range, 1+zoom_range]
channel_shift_rangeï¼šæµ®ç‚¹æ•°ï¼Œéšæœºé€šé“åç§»çš„å¹…åº¦
fill_modeï¼šï¼›â€˜constantâ€™ï¼Œâ€˜nearestâ€™ï¼Œâ€˜reflectâ€™æˆ–â€˜wrapâ€™ä¹‹ä¸€ï¼Œå½“è¿›è¡Œå˜æ¢æ—¶è¶…å‡ºè¾¹ç•Œçš„ç‚¹å°†æ ¹æ®æœ¬å‚æ•°ç»™å®šçš„æ–¹æ³•è¿›è¡Œå¤„ç†
cvalï¼šæµ®ç‚¹æ•°æˆ–æ•´æ•°ï¼Œå½“fill_mode=constantæ—¶ï¼ŒæŒ‡å®šè¦å‘è¶…å‡ºè¾¹ç•Œçš„ç‚¹å¡«å……çš„å€¼
horizontal_flipï¼šå¸ƒå°”å€¼ï¼Œè¿›è¡Œéšæœºæ°´å¹³ç¿»è½¬
vertical_flipï¼šå¸ƒå°”å€¼ï¼Œè¿›è¡Œéšæœºç«–ç›´ç¿»è½¬
rescale: é‡æ”¾ç¼©å› å­,é»˜è®¤ä¸ºNone. å¦‚æœä¸ºNoneæˆ–0åˆ™ä¸è¿›è¡Œæ”¾ç¼©,å¦åˆ™ä¼šå°†è¯¥æ•°å€¼ä¹˜åˆ°æ•°æ®ä¸Š(åœ¨åº”ç”¨å…¶ä»–å˜æ¢ä¹‹å‰)
dim_orderingï¼šâ€˜tfâ€™å’Œâ€˜thâ€™ä¹‹ä¸€ï¼Œè§„å®šæ•°æ®çš„ç»´åº¦é¡ºåºã€‚â€˜tfâ€™æ¨¡å¼ä¸‹æ•°æ®çš„å½¢çŠ¶ä¸ºsamples, width, height, channelsï¼Œâ€˜thâ€™ä¸‹å½¢çŠ¶ä¸º(samples, channels, width, height).è¯¥å‚æ•°çš„é»˜è®¤å€¼æ˜¯Kerasé…ç½®æ–‡ä»¶~/.keras/keras.jsonçš„image_dim_orderingå€¼,å¦‚æœä½ ä»æœªè®¾ç½®è¿‡çš„è¯,å°±æ˜¯'th'
</code></pre></div></div>
<p>æœ‰äº†è¿™ä¸ªå‡½æ•°ï¼Œé‚£æ€ä¹ˆå…·ä½“å¯¹ä¸€å¼ å›¾ç‰‡æˆ–è€…æ‰¹é‡åŒ–å¤„ç†</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from keras.preprocessing.image import ImageDataGenerator, array_to_img, img_to_array, load_img
datagen = ImageDataGenerator(
	rotation_range=0.2,
	width_shift_range=0.2,
	height_shift_range=0.2,
	shear_range=0.2,
	zoom_range=0.2,
	horizontal_flip=True,
	fill_mode='nearest')
	
img = load_img('lena.jpg')
x = img_to_array(img)
x = x.reshape((1,) + x.shape)
i = 0
for batch in datagen.flow(x,
	batch_size=1,
	save_to_dir='data/preview',   #ä¿å­˜åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹
	save_prefix='lena',
	save_format='jpg'):
    i += 1
    if i &gt; 20:  #ç”Ÿæˆ20å¼ å›¾
        break
</code></pre></div></div>
<p>å…¶ä¸­flowå‡½æ•°çš„å‚æ•°è§£é‡Š</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Xï¼šæ ·æœ¬æ•°æ®ï¼Œç§©åº”ä¸º4.åœ¨é»‘ç™½å›¾åƒçš„æƒ…å†µä¸‹channelè½´çš„å€¼ä¸º1ï¼Œåœ¨å½©è‰²å›¾åƒæƒ…å†µä¸‹å€¼ä¸º3
batch_sizeï¼šæ•´æ•°ï¼Œé»˜è®¤32
shuffleï¼šå¸ƒå°”å€¼ï¼Œæ˜¯å¦éšæœºæ‰“ä¹±æ•°æ®ï¼Œé»˜è®¤ä¸ºTrue
save_to_dirï¼šNoneæˆ–å­—ç¬¦ä¸²ï¼Œè¯¥å‚æ•°èƒ½è®©ä½ å°†æå‡åçš„å›¾ç‰‡ä¿å­˜èµ·æ¥ï¼Œç”¨ä»¥å¯è§†åŒ–
save_prefixï¼šå­—ç¬¦ä¸²ï¼Œä¿å­˜æå‡åå›¾ç‰‡æ—¶ä½¿ç”¨çš„å‰ç¼€, ä»…å½“è®¾ç½®äº†save_to_diræ—¶ç”Ÿæ•ˆ
save_formatï¼šâ€pngâ€æˆ–â€jpegâ€ä¹‹ä¸€ï¼ŒæŒ‡å®šä¿å­˜å›¾ç‰‡çš„æ•°æ®æ ¼å¼,é»˜è®¤â€jpegâ€
yields:å½¢å¦‚(x,y)çš„tuple,xæ˜¯ä»£è¡¨å›¾åƒæ•°æ®çš„numpyæ•°ç»„.yæ˜¯ä»£è¡¨æ ‡ç­¾çš„numpyæ•°ç»„.è¯¥è¿­ä»£å™¨æ— é™å¾ªç¯.
seed: æ•´æ•°,éšæœºæ•°ç§å­
</code></pre></div></div>
<p><strong>ä»¥ä¸Šæ‰€æœ‰è¯¦æƒ…å¯ä»¥å‚è€ƒ<a href="https://keras.io/preprocessing/image/">keraså®˜æ–¹æ–‡æ¡£</a></strong>
<strong>å¦‚æœä½ å¯¹æ¯ä¸€æ­¥çš„æ•ˆæœä¸å¤Ÿæ¸…æ¥šï¼Œè¯·å‚è€ƒ<a href="https://zhuanlan.zhihu.com/p/30197320">å‚æ•°æ¼”ç¤º</a></strong></p>

<hr />

<h1 id="pca-jitteringæ–¹æ³•">PCA Jitteringæ–¹æ³•</h1>
<p>PCAæ˜¯ä¸»æˆåˆ†åˆ†æï¼Œå®ƒæ˜¯ä¸ºäº†å‡å°‘æ•°æ®é›†çš„ç»´æ•°ï¼ŒåŒæ—¶ä¿æŒæ•°æ®é›†ä¸­çš„å¯¹æ–¹å·®è´¡çŒ®æœ€å¤§çš„ç‰¹å¾ï¼Œä¿ç•™ä½é˜¶ä¸»æˆåˆ†ï¼Œå¿½ç•¥é«˜é˜¶ä¸»æˆåˆ†ã€‚<strong>å®æ–½è¿‡ç¨‹æ˜¯å¯¹åæ–¹å·®çŸ©é˜µè¿›è¡Œç‰¹å¾åˆ†è§£ï¼Œå¾—åˆ°ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡ã€‚</strong> å…³äºPCAï¼Œå¯ä»¥å»æŸ¥çœ‹é“¾æ¥ã€‚</p>

<p>æ ¹æ®AlexNetè®ºæ–‡ï¼Œå†…å®¹æè¿°ä¸ºï¼š</p>
<blockquote>
  <p>æ·»åŠ å¤šä¸ªæ‰¾åˆ°çš„ä¸»æˆåˆ†ï¼Œå…¶å¹…åº¦ä¸ç›¸åº”çš„ç‰¹å¾å€¼æˆæ­£æ¯”ï¼Œå¹¶è¦ä¹˜ä»¥ä¸€ä¸ªé›¶å‡å€¼ï¼Œæ ‡å‡†å·®ä¸º0.1çš„é«˜æ–¯å˜é‡ï¼Œå¯¹æ¯ä¸€ä¸ªRGBå€¼ I<sub>xy</sub>=[I<sub>xy</sub><sup>R</sup> , I<sub>xy</sub><sup>G</sup> , I<sub>xy</sub><sup>B</sup> ] è¦æ·»åŠ [p<sub>1</sub> , p<sub>2</sub> , p<sub>3</sub>] [Î±<sub>1</sub>Î»Î±<sub>1</sub> ï¼Œ Î±<sub>2</sub>Î»Î±<sub>2</sub> ï¼Œ Î±<sub>3</sub>Î»Î±<sub>3</sub>] ï¼Œpå’ŒÎ»æ˜¯åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾å‘é‡å’Œç‰¹å¾å€¼ï¼ŒÎ±æ˜¯é«˜æ–¯å˜é‡ï¼Œè¯¥é«˜æ–¯å˜é‡çš„æ ‡å‡†å·®å‚æ•°ä¹Ÿæ˜¯å”¯ä¸€å¼•å…¥çš„å¤–éƒ¨å˜é‡</p>
</blockquote>

<p>å¤ç°ä»£ç å¦‚ä¸‹ï¼ˆä½¿ç”¨æ–¹æ³•åœ¨åé¢ï¼‰ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageOps</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">misc</span>
<span class="kn">import</span> <span class="nn">imageio</span>
 
<span class="k">def</span> <span class="nf">PCA_Jittering</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">img_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">img_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">img_num</span><span class="p">):</span>
        <span class="n">img_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">img_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="nb">open</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>    
        
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s">'float32'</span><span class="p">)</span>

        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span> <span class="o">/</span> <span class="mf">255.0</span>
        <span class="n">img_size</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span> <span class="o">//</span> <span class="mi">3</span>    <span class="c1">#è½¬æ¢ä¸ºå•é€šé“
</span>        <span class="n">img1</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">img_size</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">img1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">img1</span><span class="p">)</span>   <span class="c1">#è½¬ç½®
</span>        <span class="n">img_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">([</span><span class="n">img1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">img1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">img1</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>    <span class="c1">#åæ–¹å·®çŸ©é˜µ
</span>        <span class="n">lamda</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">img_cov</span><span class="p">)</span>     <span class="c1">#å¾—åˆ°ä¸Šè¿°åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾å‘é‡å’Œç‰¹å¾å€¼
</span>        
        <span class="c1">#pæ˜¯åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾å‘é‡
</span>        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>    <span class="c1">#è½¬ç½®å›å»
</span>
        <span class="c1">#ç”Ÿæˆé«˜æ–¯éšæœºæ•°********å¯ä»¥ä¿®æ”¹
</span>        <span class="n">alpha1</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">alpha2</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">alpha3</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        
        <span class="c1">#lamdaæ˜¯åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾å€¼
</span>        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="n">alpha1</span><span class="o">*</span><span class="n">lamda</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alpha2</span><span class="o">*</span><span class="n">lamda</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">alpha3</span><span class="o">*</span><span class="n">lamda</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>     <span class="c1">#è½¬ç½®
</span>
        <span class="c1">#å¾—åˆ°ä¸»æˆåˆ†
</span>        <span class="n">add_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
        
        <span class="c1">#åœ¨åŸå›¾åƒçš„åŸºç¡€ä¸ŠåŠ ä¸Šä¸»æˆåˆ†
</span>        <span class="n">img2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">img</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">add_num</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">img</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">add_num</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">img</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">add_num</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>

        <span class="c1">#ç°åœ¨æ˜¯BGRï¼Œè¦è½¬æˆRBGå†è¿›è¡Œä¿å­˜
</span>        <span class="n">img2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">img2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">img2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">img2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">save_name</span> <span class="o">=</span> <span class="s">'pre'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">'.png'</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">save_name</span><span class="p">)</span>
        <span class="n">misc</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span><span class="n">img2</span><span class="p">)</span>
        
        <span class="c1">#plt.imshow(img2)
</span>        <span class="c1">#plt.show()
</span>
<span class="n">PCA_Jittering</span><span class="p">(</span><span class="s">'testpic'</span><span class="p">)</span>
</code></pre></div></div>

<p>ä½¿ç”¨æ–¹æ³•æ˜¯ï¼šä¸»å‡½æ•°PCA_Jitterringæ‹¬å·ä¸­çš„å‚æ•°æ˜¯å½“å‰è·¯å¾„ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå®ƒä¼šè‡ªåŠ¨åŠ è½½æ–‡ä»¶å¤¹ä¸­çš„å›¾ç‰‡ã€‚è°ƒæ•´è¯¥æ–¹æ³•çš„å”¯ä¸€å‚æ•°ï¼ˆé«˜æ–¯å‡½æ•°çš„æ ‡å‡†å·®ï¼‰æ˜¯åœ¨æ ‡è®°äº†ç”Ÿæˆé«˜æ–¯éšæœºæ•°é‚£é‡Œï¼Œæ”¹å˜å‚æ•°ä¼šå¾—åˆ°å¾ˆä¸åŒçš„æ•ˆæœã€‚</p>

<hr />
<h1 id="label-shuffling">Label Shuffling</h1>
<p>ç”±äºåœºæ™¯æ•°æ®é›†ä¸å‡åŒ€çš„ç±»åˆ«åˆ†å¸ƒï¼Œç»™æ¨¡å‹è®­ç»ƒå¸¦æ¥äº†å›°éš¾ã€‚æµ·åº·å¨è§†æå‡ºäº†Label Shufflingçš„ç±»åˆ«å¹³è¡¡ç­–ç•¥ã€‚åœ¨Class-Aware Samplingæ–¹æ³•ä¸­ï¼Œå®šä¹‰äº†2ç§åˆ—è¡¨ï¼Œä¸€æ˜¯ç±»åˆ«åˆ—è¡¨ï¼Œä¸€æ˜¯æ¯ä¸ªç±»åˆ«çš„å›¾åƒåˆ—è¡¨ï¼Œå¯¹äº80ç±»çš„åˆ†ç±»é—®é¢˜æ¥è¯´ï¼Œå°±éœ€è¦äº‹å…ˆå®šä¹‰80ä¸ªåˆ—è¡¨ï¼Œå¾ˆä¸æ–¹ä¾¿ã€‚å¯¹æ­¤è¿›è¡Œäº†æ”¹è¿›ï¼Œåªéœ€è¦åŸå§‹çš„å›¾åƒåˆ—è¡¨å°±å¯ä»¥å®ŒæˆåŒæ ·çš„å‡åŒ€é‡‡æ ·ä»»åŠ¡ã€‚</p>

<p>æ­¥éª¤å¦‚ä¸‹ï¼š</p>

<blockquote>
  <p>é¦–å…ˆå¯¹åŸå§‹çš„å›¾åƒåˆ—è¡¨ï¼ŒæŒ‰ç…§æ ‡ç­¾é¡ºåºè¿›è¡Œæ’åºï¼›ç„¶åè®¡ç®—æ¯ä¸ªç±»åˆ«çš„æ ·æœ¬æ•°é‡ï¼Œå¹¶å¾—åˆ°æ ·æœ¬æœ€å¤šçš„é‚£ä¸ªç±»åˆ«çš„æ ·æœ¬æ•°ã€‚æ ¹æ®è¿™ä¸ªæœ€å¤šçš„æ ·æœ¬æ•°ï¼Œå¯¹æ¯ç±»éšæœºéƒ½äº§ç”Ÿä¸€ä¸ªéšæœºæ’åˆ—çš„åˆ—è¡¨ï¼›ç„¶åç”¨æ¯ä¸ªç±»åˆ«çš„åˆ—è¡¨ä¸­çš„æ•°å¯¹å„è‡ªç±»åˆ«çš„æ ·æœ¬æ•°æ±‚ä½™ï¼Œå¾—åˆ°ä¸€ä¸ªç´¢å¼•å€¼ï¼Œä»è¯¥ç±»çš„å›¾åƒä¸­æå–å›¾åƒï¼Œç”Ÿæˆè¯¥ç±»çš„å›¾åƒéšæœºåˆ—è¡¨ï¼›ç„¶åæŠŠæ‰€æœ‰ç±»åˆ«çš„éšæœºåˆ—è¡¨è¿åœ¨ä¸€èµ·ï¼Œåšä¸ªRandom Shufflingï¼Œå¾—åˆ°æœ€åçš„å›¾åƒåˆ—è¡¨ï¼Œç”¨è¿™ä¸ªåˆ—è¡¨è¿›è¡Œè®­ç»ƒã€‚æ¯ä¸ªåˆ—è¡¨ï¼Œåˆ°è¾¾æœ€åä¸€å¼ å›¾åƒçš„æ—¶å€™ï¼Œç„¶åå†é‡æ–°åšä¸€éè¿™äº›æ­¥éª¤ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„åˆ—è¡¨ï¼Œæ¥ç€è®­ç»ƒã€‚Label Shufflingæ–¹æ³•çš„ä¼˜ç‚¹åœ¨äºï¼Œåªéœ€è¦åŸå§‹å›¾åƒåˆ—è¡¨ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯åœ¨å†…å­˜ä¸­åœ¨çº¿å®Œæˆï¼Œéå¸¸æ˜“äºå®ç°ã€‚</p>
</blockquote>

<p>ç”¨ä¸€å¹…å›¾ç‰‡å¯ä»¥ç”ŸåŠ¨åœ°å±•ç¤ºè¿™ä¸ªè¿‡ç¨‹
<img src="https://i.imgur.com/QzH9wMp.png" alt="" /></p>

<p>å®ç°çš„ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">random</span>

<span class="n">category</span><span class="o">=</span><span class="mi">80</span>

<span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s">'scene_train_20170904.txt'</span><span class="p">)</span>  <span class="c1">#æŒ‰ç…§labelä»å°åˆ°å¤§æ’åº
#f=open('scene_validation_20170908.txt')
</span><span class="n">dicts</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
    <span class="n">image</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">label</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">dicts</span><span class="p">[</span><span class="n">image</span><span class="p">]</span><span class="o">=</span><span class="n">label</span>
<span class="n">dicts</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">dicts</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">counts</span><span class="o">=</span><span class="p">{}</span>   <span class="c1">#ç»Ÿè®¡æ¯ä¸€ç±»labelçš„æ•°ç›®
</span><span class="n">new_dicts</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">category</span><span class="p">):</span>
    <span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">dicts</span><span class="p">:</span>
    <span class="n">line</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="c1">#print line
</span>    <span class="n">counts</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">+=</span><span class="mi">1</span>
    <span class="n">new_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="c1">#print counts
</span>
<span class="c1">#for line in new_dicts:
#    print line
</span>
<span class="n">tab</span><span class="o">=</span><span class="p">[]</span>  <span class="c1">#æŠŠåŸåˆ—è¡¨æŒ‰ç…§æ¯ä¸€ç±»åˆ†æˆå„ä¸ªblockå¹¶å½¢æˆæ–°åˆ—è¡¨
</span><span class="n">origin_index</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">category</span><span class="p">):</span>
    <span class="n">block</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
        <span class="n">block</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_dicts</span><span class="p">[</span><span class="n">origin_index</span><span class="p">])</span>
        <span class="n">origin_index</span><span class="o">+=</span><span class="mi">1</span>
    <span class="c1">#print block
</span>    <span class="n">tab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
<span class="c1">#print tab
</span>
<span class="n">nums</span><span class="o">=</span><span class="p">[]</span> <span class="c1">#æ‰¾åˆ°æ•°ç›®æœ€å¤šçš„labelç±»åˆ«
</span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">:</span>
    <span class="n">nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
<span class="n">nums</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1">#print nums
</span>
<span class="n">lists</span><span class="o">=</span><span class="p">[]</span>    <span class="c1">#å½¢æˆéšæœºlabelåºåˆ—
</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">lists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="c1">#print lists
</span><span class="n">all_index</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">category</span><span class="p">):</span>
    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">lists</span><span class="p">)</span>
    <span class="c1">#print lists
</span>    <span class="n">lists_res</span><span class="o">=</span><span class="p">[</span><span class="n">j</span><span class="o">%</span><span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">lists</span><span class="p">]</span>
    <span class="n">all_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lists_res</span><span class="p">)</span>
    <span class="c1">#print lists_res
#print all_index
</span>
<span class="c1">#f=open('train_shuffle_labels.txt','w') #æŒ‰ç…§éšæœºåºåˆ—æå–å›¾åƒç”Ÿæˆæœ€åçš„æ ‡ç­¾
#f=open('val_shuffle_labels.txt','w')
</span><span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s">'train_shuffle_labels.lst'</span><span class="p">,</span><span class="s">'w'</span><span class="p">)</span>
<span class="c1">#f=open('val_shuffle_labels.lst','w')
</span><span class="n">shuffle_labels</span><span class="o">=</span><span class="p">[]</span>
<span class="n">index</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">all_index</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
        <span class="n">shuffle_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tab</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    <span class="n">index</span><span class="o">+=</span><span class="mi">1</span>
<span class="c1">#print shuffle_labels
</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">shuffle_labels</span><span class="p">)</span>
<span class="nb">id</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">shuffle_labels</span><span class="p">:</span>
    <span class="c1">#print line
</span>    <span class="c1">#f.write(line[0]+' '+str(line[1]))
</span>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span><span class="o">+</span><span class="s">'</span><span class="se">\t</span><span class="s">'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s">'</span><span class="se">\t</span><span class="s">'</span><span class="o">+</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
    <span class="nb">id</span><span class="o">+=</span><span class="mi">1</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<hr />
<p>å¦å¤–æˆ‘è§‰å¾—å•çº¯åœ°å¤åˆ¶ç²˜è´´ä¼šä¸ä¼šæœ‰ç”¨å‘¢</p>
:ET